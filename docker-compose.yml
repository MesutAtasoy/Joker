version: '3.4'

services:
  consul:
    image: consul
    
  nosqldata:
    image: mongo
    
  postgres:
    image: postgres
    
  seq:
    image: datalust/seq:latest

  rabbitmq:
    image: rabbitmq:3-management-alpine
    
  campaign.api:
    image: ${DOCKER_REGISTRY-}campaignapi
    build:
      context: .
      dockerfile: src/Services/Campaign/Campaign.Api/Dockerfile
    depends_on:
      - nosqldata
      - seq
      - rabbitmq        

  location.api:
    image: ${DOCKER_REGISTRY-}locationapi
    build:
      context: .
      dockerfile: src/Services/Location/Location.Api/Dockerfile
    depends_on:
      - postgres
      - seq
      - rabbitmq
          
  management.api:
    image: ${DOCKER_REGISTRY-}managementapi
    build:
      context: .
      dockerfile: src/Services/Management/Management.Api/Dockerfile
    depends_on:
      - postgres
      - seq
      - rabbitmq
      
  merchant.api:
    image: ${DOCKER_REGISTRY-}merchantapi
    build:
      context: .
      dockerfile: src/Services/Merchant/Merchant.Api/Dockerfile
    depends_on:
      - nosqldata
      - seq
      - rabbitmq

  search.api:
    image: ${DOCKER_REGISTRY-}searchapi
    build:
      context: .
      dockerfile: src/Services/Search/Search.Api/Dockerfile
    depends_on:
      - seq
      - rabbitmq
              
  aggregator.api:
    image: ${DOCKER_REGISTRY-}aggregatorapi
    build:
      context: .
      dockerfile: src/Aggregators/Aggregator.Api/Dockerfile

  gateway.web.api:
    image: ${DOCKER_REGISTRY-}gatewaywebapi
    build:
      context: .
      dockerfile: src/Gateways/Gateway.Web.Api/Dockerfile      
    
